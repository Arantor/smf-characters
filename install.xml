<?xml version="1.0"?>
<!DOCTYPE modification SYSTEM "http://www.simplemachines.org/xml/modification">
<modification xmlns="http://www.simplemachines.org/xml/modification" xmlns:smf="http://www.simplemachines.org/">
	<id>Arantor:Characters</id>
	<version>1.0</version>

	<!-- Get the current user's character -->
	<file name="$sourcedir/Load.php">
		<!-- Actually get the data -->
		<operation>
			<search position="replace"><![CDATA[
			$request = $smcFunc['db_query']('', '
				SELECT mem.*, IFNULL(a.id_attach, 0) AS id_attach, a.filename, a.attachment_type
				FROM {db_prefix}members AS mem
					LEFT JOIN {db_prefix}attachments AS a ON (a.id_member = {int:id_member})
				WHERE mem.id_member = {int:id_member}
				LIMIT 1',
				array(
					'id_member' => $id_member,
				)
			);]]></search>
			<add><![CDATA[
			$request = $smcFunc['db_query']('', '
				SELECT mem.*, chars.id_character, chars.character_name, chars.avatar AS char_avatar, chars.signature AS char_signature,
					chars.id_theme, IFNULL(a.id_attach, 0) AS id_attach, a.filename, a.attachment_type
				FROM {db_prefix}members AS mem
					LEFT JOIN {db_prefix}attachments AS a ON (a.id_member = {int:id_member})
					LEFT JOIN {db_prefix}characters AS chars ON (chars.id_character = mem.current_character)
				WHERE mem.id_member = {int:id_member}
				LIMIT 1',
				array(
					'id_member' => $id_member,
				)
			);]]></add>
		</operation>
		<operation>
			<search position="replace"><![CDATA[
	if (!empty($new_loaded_ids) && $set !== 'minimal')
	{]]></search>
			<add><![CDATA[
	if (!empty($new_loaded_ids) && $set !== 'minimal')
	{
		$request = $smcFunc['db_query']('', '
			SELECT id_member, id_character, character_name, avatar, signature, id_theme, posts, age, date_created, last_active
			FROM {db_prefix}characters
			WHERE id_member IN ({array_int:loaded_ids})
			ORDER BY NULL',
			array(
				'loaded_ids' => $new_loaded_ids,
			)
		);
		while ($row = $smcFunc['db_fetch_assoc']($request))
			$user_profile[$row['id_member']]['characters'][$row['id_character']] = array(
				'id_character' => $row['id_character'],
				'character_name' => $row['character_name'],
				'character_url' => '?action=profile;u=' . $row['id_member'] . ';area=characters;char=' . $row['id_character'],
				'avatar' => $row['avatar'],
				'signature' => $row['signature'],
				'sig_parsed' => !empty($row['signature']) ? parse_bbc($row['signature'], true, 'sig_char_' . $row['id_character']) : '',
				'posts' => $row['posts'],
				'age' => $row['age'],
				'date_created' => $row['date_created'],
				'last_active' => $row['last_active'],
			);
		$smcFunc['db_free_result']($request);

		foreach ($user_profile as $id_member => $member)
		{
			if (!isset($member['characters'])) {
				$user_profile[$id_member]['characters'] = array();
			} else {
				uasort($user_profile[$id_member]['characters'], function ($a, $b) {
					return $a['character_name'] > $b['character_name'] ? 1 : ($a['character_name'] < $a['character_name'] ? -1 : 0);
				});
			}
		}]]></add>
		</operation>
	</file>

	<!-- Make sure we push the current character id into the log when we fill it generally -->
	<file name="$sourcedir/Logging.php">
		<operation>
			<search position="replace"><![CDATA[
		$smcFunc['db_insert']($do_delete ? 'ignore' : 'replace',
			'{db_prefix}log_online',
			array('session' => 'string', 'id_member' => 'int', 'id_spider' => 'int', 'log_time' => 'int', 'ip' => 'raw', 'url' => 'string'),
			array($session_id, $user_info['id'], empty($_SESSION['id_robot']) ? 0 : $_SESSION['id_robot'], time(), 'IFNULL(INET_ATON(\'' . $user_info['ip'] . '\'), 0)', $serialized),
			array('session')
		);]]></search>
			<add><![CDATA[
		$smcFunc['db_insert']($do_delete ? 'ignore' : 'replace',
			'{db_prefix}log_online',
			array('session' => 'string', 'id_member' => 'int', 'id_character' => 'int', 'id_spider' => 'int', 'log_time' => 'int', 'ip' => 'raw', 'url' => 'string'),
			array($session_id, $user_info['id'], $user_info['id_character'], empty($_SESSION['id_robot']) ? 0 : $_SESSION['id_robot'], time(), 'IFNULL(INET_ATON(\'' . $user_info['ip'] . '\'), 0)', $serialized),
			array('session')
		);]]></add>
		</operation>
		<operation>
			<search position="replace"><![CDATA[
		$user_settings['total_time_logged_in'] += time() - $_SESSION['timeOnlineUpdated'];]]></search>
			<add><![CDATA[
		$user_settings['total_time_logged_in'] += time() - $_SESSION['timeOnlineUpdated'];
		$smcFunc['db_query']('', '
			UPDATE {db_prefix}characters
			SET last_active = {int:last_active}
			WHERE id_character = {int:character}',
			array(
				'last_active' => time(),
				'character' => $user_info['id_character'],
			)
		);]]></add>
		</operation>
	</file>
	<file name="$sourcedir/Who.php">
		<operation>
			<search position="replace"><![CDATA[
		SELECT
			lo.log_time, lo.id_member, lo.url, INET_NTOA(lo.ip) AS ip, mem.real_name,
			lo.session, mg.online_color, IFNULL(mem.show_online, 1) AS show_online,
			lo.id_spider
		FROM {db_prefix}log_online AS lo
			LEFT JOIN {db_prefix}members AS mem ON (lo.id_member = mem.id_member)
			LEFT JOIN {db_prefix}membergroups AS mg ON (mg.id_group = CASE WHEN mem.id_group = {int:regular_member} THEN mem.id_post_group ELSE mem.id_group END)' . (!empty($conditions) ? ']]></search>
			<add><![CDATA[
		SELECT
			lo.log_time, lo.id_member, lo.url, INET_NTOA(lo.ip) AS ip, lo.id_character, IFNULL(chars.character_name, mem.real_name) AS real_name,
			lo.session, mg.online_color, IFNULL(mem.show_online, 1) AS show_online,
			lo.id_spider
		FROM {db_prefix}log_online AS lo
			LEFT JOIN {db_prefix}members AS mem ON (lo.id_member = mem.id_member)
			LEFT JOIN {db_prefix}membergroups AS mg ON (mg.id_group = CASE WHEN mem.id_group = {int:regular_member} THEN mem.id_post_group ELSE mem.id_group END)
			LEFT JOIN {db_prefix}characters AS chars ON (lo.id_character = chars.id_character)' . (!empty($conditions) ? ']]></add>
		</operation>
		<operation>
			<search position="replace"><![CDATA[
		$context['members'][$row['session']] = array(
			'id' => $row['id_member'],]]></search>
			<add><![CDATA[
		$context['members'][$row['session']] = array(
			'id_character' => $row['id_character'],
			'id' => $row['id_member'],]]></add>
		</operation>
		<operation>
			<search position="replace"><![CDATA[
			$context['members'][$i] += $memberContext[$member['id']];
	}]]></search>
			<add><![CDATA[
			$context['members'][$i] += $memberContext[$member['id']];

		if (!empty($member['id_character']) && !empty($context['members'][$i]['characters'][$member['id_character']]))
		{
			// Need to 'fix' a few things.
			$character = $context['members'][$i]['characters'][$member['id_character']];
			$context['members'][$i]['name'] = $character['character_name'];
			$context['members'][$i]['href'] .= ';area=characters;char=' . $member['id_character'];
		}
	}]]></add>
		</operation>
	</file>
	<file name="$sourcedir/Subs-MembersOnline.php">
		<operation>
			<search position="replace"><![CDATA[
	$request = $smcFunc['db_query']('', '
		SELECT
			lo.id_member, lo.log_time, lo.id_spider, mem.real_name, mem.member_name, mem.show_online,
			mg.online_color, mg.id_group, mg.group_name
		FROM {db_prefix}log_online AS lo
			LEFT JOIN {db_prefix}members AS mem ON (mem.id_member = lo.id_member)
			LEFT JOIN {db_prefix}membergroups AS mg ON (mg.id_group = CASE WHEN mem.id_group = {int:reg_mem_group} THEN mem.id_post_group ELSE mem.id_group END)',]]></search>
			<add><![CDATA[
	$request = $smcFunc['db_query']('', '
		SELECT
			lo.id_member, lo.log_time, lo.id_spider, chars.id_character, IFNULL(chars.character_name, mem.real_name) AS real_name, mem.member_name, mem.show_online,
			mg.online_color, mg.id_group, mg.group_name
		FROM {db_prefix}log_online AS lo
			LEFT JOIN {db_prefix}members AS mem ON (mem.id_member = lo.id_member)
			LEFT JOIN {db_prefix}membergroups AS mg ON (mg.id_group = CASE WHEN mem.id_group = {int:reg_mem_group} THEN mem.id_post_group ELSE mem.id_group END)
			LEFT JOIN {db_prefix}characters AS chars ON (lo.id_character = chars.id_character)',]]></add>
		</operation>
		<operation>
			<search position="replace"><![CDATA[
		// Some basic color coding...
		if (!empty($row['online_color']))
			$link = '<a href="' . $scripturl . '?action=profile;u=' . $row['id_member'] . '" style="color: ' . $row['online_color'] . ';">' . $row['real_name'] . '</a>';
		else
			$link = '<a href="' . $scripturl . '?action=profile;u=' . $row['id_member'] . '">' . $row['real_name'] . '</a>';]]></search>
			<add><![CDATA[
		// Some basic color coding...
		if (!empty($row['online_color']))
			$link = '<a href="' . $scripturl . '?action=profile;u=' . $row['id_member'] . (!empty($row['id_character']) ? ';area=characters;char=' . $row['id_character'] : '') . '" style="color: ' . $row['online_color'] . ';">' . $row['real_name'] . '</a>';
		else
			$link = '<a href="' . $scripturl . '?action=profile;u=' . $row['id_member'] . (!empty($row['id_character']) ? ';area=characters;char=' . $row['id_character'] : '') . '">' . $row['real_name'] . '</a>';]]></add>
		</operation>
	</file>
	<file name="$sourcedir/Display.php">
		<operation>
			<search position="replace"><![CDATA[
			SELECT
				lo.id_member, lo.log_time, mem.real_name, mem.member_name, mem.show_online,
				mg.online_color, mg.id_group, mg.group_name
			FROM {db_prefix}log_online AS lo
				LEFT JOIN {db_prefix}members AS mem ON (mem.id_member = lo.id_member)
				LEFT JOIN {db_prefix}membergroups AS mg ON (mg.id_group = CASE WHEN mem.id_group = {int:reg_id_group} THEN mem.id_post_group ELSE mem.id_group END)]]></search>
			<add><![CDATA[
			SELECT
				lo.id_member, lo.log_time, chars.id_character, IFNULL(chars.character_name, mem.real_name) AS real_name, mem.member_name, mem.show_online,
				mg.online_color, mg.id_group, mg.group_name
			FROM {db_prefix}log_online AS lo
				LEFT JOIN {db_prefix}members AS mem ON (mem.id_member = lo.id_member)
				LEFT JOIN {db_prefix}membergroups AS mg ON (mg.id_group = CASE WHEN mem.id_group = {int:reg_id_group} THEN mem.id_post_group ELSE mem.id_group END)
				LEFT JOIN {db_prefix}characters AS chars ON (lo.id_character = chars.id_character)]]></add>
		</operation>
		<operation>
			<search position="replace"><![CDATA[
			if (!empty($row['online_color']))
				$link = '<a href="' . $scripturl . '?action=profile;u=' . $row['id_member'] . '" style="color: ' . $row['online_color'] . ';">' . $row['real_name'] . '</a>';
			else
				$link = '<a href="' . $scripturl . '?action=profile;u=' . $row['id_member'] . '">' . $row['real_name'] . '</a>';]]></search>
			<add><![CDATA[
			if (!empty($row['online_color']))
				$link = '<a href="' . $scripturl . '?action=profile;u=' . $row['id_member'] . (!empty($row['id_character']) ? ';area=characters;char=' . $row['id_character'] : '') . '" style="color: ' . $row['online_color'] . ';">' . $row['real_name'] . '</a>';
			else
				$link = '<a href="' . $scripturl . '?action=profile;u=' . $row['id_member'] . (!empty($row['id_character']) ? ';area=characters;char=' . $row['id_character'] : '') . '">' . $row['real_name'] . '</a>';]]></add>
		</operation>
	</file>
	<file name="$sourcedir/MessageIndex.php">
		<operation>
			<search position="replace"><![CDATA[
			SELECT
				lo.id_member, lo.log_time, mem.real_name, mem.member_name, mem.show_online,
				mg.online_color, mg.id_group, mg.group_name
			FROM {db_prefix}log_online AS lo
				LEFT JOIN {db_prefix}members AS mem ON (mem.id_member = lo.id_member)
				LEFT JOIN {db_prefix}membergroups AS mg ON (mg.id_group = CASE WHEN mem.id_group = {int:reg_member_group} THEN mem.id_post_group ELSE mem.id_group END)]]></search>
			<add><![CDATA[
			SELECT
				lo.id_member, lo.log_time, chars.id_character, IFNULL(chars.character_name, mem.real_name) AS real_name, mem.member_name, mem.show_online,
				mg.online_color, mg.id_group, mg.group_name
			FROM {db_prefix}log_online AS lo
				LEFT JOIN {db_prefix}members AS mem ON (mem.id_member = lo.id_member)
				LEFT JOIN {db_prefix}membergroups AS mg ON (mg.id_group = CASE WHEN mem.id_group = {int:reg_member_group} THEN mem.id_post_group ELSE mem.id_group END)
				LEFT JOIN {db_prefix}characters AS chars ON (lo.id_character = chars.id_character)]]></add>
		</operation>
		<operation>
			<search position="replace"><![CDATA[
			if (!empty($row['online_color']))
				$link = '<a href="' . $scripturl . '?action=profile;u=' . $row['id_member'] . '" style="color: ' . $row['online_color'] . ';">' . $row['real_name'] . '</a>';
			else
				$link = '<a href="' . $scripturl . '?action=profile;u=' . $row['id_member'] . '">' . $row['real_name'] . '</a>';]]></search>
			<add><![CDATA[
			if (!empty($row['online_color']))
				$link = '<a href="' . $scripturl . '?action=profile;u=' . $row['id_member'] . (!empty($row['id_character']) ? ';area=characters;char=' . $row['id_character'] : '') . '" style="color: ' . $row['online_color'] . ';">' . $row['real_name'] . '</a>';
			else
				$link = '<a href="' . $scripturl . '?action=profile;u=' . $row['id_member'] . (!empty($row['id_character']) ? ';area=characters;char=' . $row['id_character'] : '') . '">' . $row['real_name'] . '</a>';]]></add>
		</operation>
		<operation>
			<search position="replace"><![CDATA[
						'href' => !empty($row['first_id_member']) ? $scripturl . '?action=profile;u=' . $row['first_id_member'] : '',
						'link' => !empty($row['first_id_member']) ? '<a href="' . $scripturl . '?action=profile;u=' . $row['first_id_member'] . '" title="' . $txt['profile_of'] . ' ' . $row['first_display_name'] . '" class="preview">' . $row['first_display_name'] . '</a>' : $row['first_display_name']]]></search>
			<add><![CDATA[
						'href' => !empty($row['first_id_member']) ? $scripturl . '?action=profile;u=' . $row['first_id_member'] : '',
						'link' => !empty($row['first_id_member']) ? '<a href="' . $scripturl . '?action=profile;u=' . $row['first_id_member'] . (!empty($row['first_character']) ? ';area=characters;char=' . $row['first_character'] : '') . '" title="' . $txt['profile_of'] . ' ' . $row['first_display_name'] . '" class="preview">' . $row['first_display_name'] . '</a>' : $row['first_display_name']]]></add>
		</operation>
		<operation>
			<search position="replace"><![CDATA[
						'href' => !empty($row['last_id_member']) ? $scripturl . '?action=profile;u=' . $row['last_id_member'] : '',
						'link' => !empty($row['last_id_member']) ? '<a href="' . $scripturl . '?action=profile;u=' . $row['last_id_member'] . '">' . $row['last_display_name'] . '</a>' : $row['last_display_name']]]></search>
			<add><![CDATA[
						'href' => !empty($row['last_id_member']) ? $scripturl . '?action=profile;u=' . $row['last_id_member'] : '',
						'link' => !empty($row['last_id_member']) ? '<a href="' . $scripturl . '?action=profile;u=' . $row['last_id_member'] . (!empty($row['last_character']) ? ';area=characters;char=' . $row['last_character'] : '') . '">' . $row['last_display_name'] . '</a>' : $row['last_display_name']]]></add>
		</operation>
	</file>

	<!-- The user's menu -->
	<file name="$themedir/index.template.php">
		<operation>
			<search position="replace"><![CDATA[
		// Secondly, PMs if we're doing them]]></search>
			<add><![CDATA[
		echo '
			<li>
				<a href="', $scripturl, '?action=profile;area=characters" id="characters_menu_top" onclick="return false;">
				', sprintf($txt['posting_as'], $GLOBALS['user_info']['character_name']), ' &#9660;</a>
				<div id="characters_menu" class="top_menu"></div>
			</li>';

		// Secondlyish, PMs if we're doing them]]></add>
		</operation>
	</file>

	<!-- Adding character details to saving -->
	<file name="$sourcedir/Post.php">
		<operation>
			<search position="replace"><![CDATA[
	$posterOptions = array(
		'id' => $user_info['id'],]]></search>
			<add><![CDATA[
	$posterOptions = array(
		'id' => $user_info['id'],
		'char_id' => $user_info['id_character'],]]></add>
		</operation>
	</file>

	<!-- Fix poster counts when approving posts -->
	<file name="$sourcedir/Subs-Post.php">
		<operation>
			<search position="replace"><![CDATA[topic_approved, b.count_posts]]></search>
			<add><![CDATA[topic_approved, b.count_posts, m.id_character]]></add>
		</operation>
		<operation>
			<search position="replace"><![CDATA[
	$member_post_changes = array();]]></search>
			<add><![CDATA[
	$member_post_changes = array();
	$char_post_changes = array();]]></add>
		</operation>
		<operation>
			<search position="replace"><![CDATA[
		// Post count for the user?
		if ($row['id_member'] && empty($row['count_posts']))
			$member_post_changes[$row['id_member']] = isset($member_post_changes[$row['id_member']]) ? $member_post_changes[$row['id_member']] + 1 : 1;]]></search>
			<add><![CDATA[
		// Post count for the user?
		if ($row['id_member'] && empty($row['count_posts']))
		{
			$member_post_changes[$row['id_member']] = isset($member_post_changes[$row['id_member']]) ? $member_post_changes[$row['id_member']] + 1 : 1;
			$char_post_changes[$row['id_character']] = isset($char_post_changes[$row['id_character']]) ? $char_post_changes[$row['id_character']] + 1 : 1;
			
		}]]></add>
		</operation>
		<operation>
			<search position="replace"><![CDATA[
	// Post count for the members?
	if (!empty($member_post_changes))
		foreach ($member_post_changes as $id_member => $count_change)
			updateMemberData($id_member, array('posts' => 'posts ' . ($approve ? '+' : '-') . ' ' . $count_change));]]></search>
			<add><![CDATA[
	// Post count for the members?
	if (!empty($member_post_changes))
		foreach ($member_post_changes as $id_member => $count_change)
			updateMemberData($id_member, array('posts' => 'posts ' . ($approve ? '+' : '-') . ' ' . $count_change));
	if (!empty($char_post_changes))
		foreach ($char_post_changes as $id_char => $count_change)
			updateCharacterData($id_char, array('posts' => 'posts ' . ($approve ? '+' : '-') . ' ' . $count_change));]]></add>
		</operation>
	</file>

	<!-- Now display the character poster -->
	<file name="$themedir/Display.template.php">
		<operation>
			<search position="replace"><![CDATA[
	echo '
								', $message['member']['link'], ']]></search>
			<add><![CDATA[
	if (isset($message['member']['characters'][$message['id_character']]))
	{
		$character = $message['member']['characters'][$message['id_character']];
		$profile_link = '<a href="' . $scripturl . $character['character_url'] . '">' . $character['character_name'] . '</a>';
	}
	else
	{
		$profile_link = $message['member']['link'];
	}
	echo '
								', $profile_link, ']]></add>
		</operation>
		<operation>
			<search position="replace"><![CDATA[
	// Show the user's avatar.
	if (!empty($modSettings['show_user_images']) && empty($options['show_no_avatars']) && !empty($message['member']['avatar']['image']))
		echo '
								<li class="avatar">
									<a href="', $scripturl, '?action=profile;u=', $message['member']['id'], '">', $message['member']['avatar']['image'], '</a>
								</li>';]]></search>
			<add><![CDATA[
	// Show the user's avatar.
	if (!empty($modSettings['show_user_images']) && empty($options['show_no_avatars']))
	{
		$character = $message['member']['characters'][$message['id_character']];
		if (isset($message['member']['characters'][$message['id_character']]))
			$profile_link = $character['character_url'];
		else
			$profile_link = '?action=profile;u=' . $message['member']['id'];

		if (!empty($message['member']['avatar']['image']))
		{
			echo '
								<li class="avatar">
									<a href="', $scripturl, $profile_link, '">', $message['member']['avatar']['image'], '</a>
								</li>';
		}
	}]]></add>
		</operation>
	</file>
	<file name="$sourcedir/Post.php">
		<operation>
			<search position="replace"><![CDATA[
		SELECT
			IFNULL(mem.real_name, m.poster_name) AS poster_name, m.poster_time,
			m.body, m.smileys_enabled, m.id_msg, m.id_member
		FROM {db_prefix}messages AS m
			LEFT JOIN {db_prefix}members AS mem ON (mem.id_member = m.id_member)]]></search>
			<add><![CDATA[
		SELECT
			IFNULL(chars.character_name, IFNULL(mem.real_name, m.poster_name)) AS poster_name, m.poster_time,
			m.body, m.smileys_enabled, m.id_msg, m.id_member
		FROM {db_prefix}messages AS m
			LEFT JOIN {db_prefix}members AS mem ON (mem.id_member = m.id_member)
			LEFT JOIN {db_prefix}characters AS chars ON (chars.id_character = m.id_character)]]></add>
		</operation>
	</file>

	<!-- Now fix the board index -->
	<file name="$sourcedir/Subs-BoardIndex.php">
		<operation>
			<search position="replace"><![CDATA[
			m.subject, m.id_topic, IFNULL(mem.real_name, m.poster_name) AS real_name,]]></search>
			<add><![CDATA[
			m.subject, m.id_topic, chars.id_character, IFNULL(IFNULL(chars.character_name, mem.real_name), m.poster_name) AS real_name,]]></add>
		</operation>
		<operation>
			<search position="replace"><![CDATA[
			LEFT JOIN {db_prefix}messages AS m ON (m.id_msg = b.id_last_msg)]]></search>
			<add><![CDATA[
			LEFT JOIN {db_prefix}messages AS m ON (m.id_msg = b.id_last_msg)
			LEFT JOIN {db_prefix}characters AS chars ON (m.id_character = chars.id_character)]]></add>
		</operation>
		<operation>
			<search position="replace"><![CDATA[
				'href' => $row_board['poster_name'] != '' && !empty($row_board['id_member']) ? $scripturl . '?action=profile;u=' . $row_board['id_member'] : '',
				'link' => $row_board['poster_name'] != '' ? (!empty($row_board['id_member']) ? '<a href="' . $scripturl . '?action=profile;u=' . $row_board['id_member'] . '">' . $row_board['real_name'] . '</a>' : $row_board['real_name']) : $txt['not_applicable'],]]></search>
			<add><![CDATA[
				'href' => $row_board['poster_name'] != '' && !empty($row_board['id_member']) ? $scripturl . '?action=profile;u=' . $row_board['id_member'] . (!empty($row_board['id_character']) ? ';area=characters;char=' . $row_board['id_character'] : ''): '',
				'link' => $row_board['poster_name'] != '' ? (!empty($row_board['id_member']) ? '<a href="' . $scripturl . '?action=profile;u=' . $row_board['id_member'] . (!empty($row_board['id_character']) ? ';area=characters;char=' . $row_board['id_character'] : '') . '">' . $row_board['real_name'] . '</a>' : $row_board['real_name']) : $txt['not_applicable'],]]></add>
		</operation>
	</file>

	<!-- Fix the autosuggester -->
	<file name="$themedir/scripts/PersonalMessage.js">
		<operation>
			<search position="replace"><![CDATA[		sControlId: this.opt.sToControlId,
		sSearchType: 'member',]]></search>
			<add><![CDATA[		sControlId: this.opt.sToControlId,
		sSearchType: 'memberchar',]]></add>
		</operation>
		<operation>
			<search position="replace"><![CDATA[		sControlId: this.opt.sBccControlId,
		sSearchType: 'member',]]></search>
			<add><![CDATA[		sControlId: this.opt.sBccControlId,
		sSearchType: 'memberchar',]]></add>
		</operation>
	</file>

	<!-- Cleaning up the profile area -->
	<file name="$sourcedir/Profile-Modify.php">
		<operation>
			<search position="replace"><![CDATA[
			'avatar_choice', 'hr', 'personal_text', 'hr',
			'bday1', 'usertitle', 'signature', 'hr',]]></search>
			<add><![CDATA[
			'personal_text', 'hr', 'bday1', 'usertitle', 'hr',]]></add>
		</operation>
		<operation>
			<search position="replace"><![CDATA['id_theme', 'smiley_set', 'hr',]]></search>
			<add><![CDATA['smiley_set', 'hr',]]></add>
		</operation>
	</file>

	<!-- Moving that fscking logout button -->
	<file name="$themedir/index.template.php">
		<operation>
			<search position="replace"><![CDATA[
		// And now we're done.
		echo '
		</ul>';]]></search>
			<add><![CDATA[
		// And now we're done.
		echo '
			<li>
				<a href="', $scripturl, '?action=logout;', $context['session_var'], '=', $context['session_id'], '">', $txt['logout'], '</a>
			</li>
		</ul>';]]></add>
		</operation>
	</file>
</modification>
